<!DOCTYPE html>
<html>
<body>

<h3>SOCKETBICLIENT</h3>

Username: <input type="text" name="username">
Password: <input type="password" name="password">

<button onclick="myLoginFunction()">Login</button> 
</br>
</br>
<button onclick="SOCKETBI.getDBList()">Get DB List</button> 

<select id="dropdown" name="dropdown"></select>
</br>
</br>
Query:</br>
<textarea rows="4" cols="50" name="dataquery"></textarea>
</br>
<button onclick="myDataRequest()">Get data</button>
</br>
</br>
<div id="queryresults"></div>

<script src="socket.io.js"></script>
<script src="socketbi.js"></script>
<script src="client.js"></script>

<script>
myDataRequest = function () {
	var q = document.getElementsByName('dataquery')[0].value;
	SOCKETBI.datarequest ({
		'dataSourceName': document.getElementsByName('dropdown')[0].value,
		'query'			: q == '' ? 'select count(*) FROM DUAL' : q 
	})
}

myLoginFunction = function () {
	SOCKETBI.login({
		'user'		: document.getElementsByName('username')[0].value,
		'password'	: document.getElementsByName('password')[0].value
	})
}

myDBListHandler = function (e) {
	console.log(e.data);
	var x = document.getElementById("dropdown");
	var i;
    for(i=x.options.length-1;i>=0;i--)
    {
        x.remove(i);
    }
	e.data.map( function(item){
		var option = document.createElement("option");
	    option.text = item;
    	x.add(option);
	})
}

myDataResponseHandler = function (e) {
	console.log(e);
	document.getElementById("queryresults").innerHTML = "Query result: " + "</br></br>" + JSON.stringify(e.data);
}

document.addEventListener("DOMContentLoaded", function(event) { 
	console.log("started");
	document.addEventListener("SOCKETBI.dbList",myDBListHandler,false);
	document.addEventListener("SOCKETBI.dataresponse",myDataResponseHandler,false);
});
</script>

</body>
</html>

